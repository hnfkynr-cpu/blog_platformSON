@{
    ViewData["Title"] = "Stats";
    Layout = null;

    var activeTab = (ViewBag.ActiveTab as string ?? "stories").ToLower();
    var people = ViewBag.People as IEnumerable<dynamic>;
}

<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Novus - Stats</title>
    <style>
        /* ================== TEMEL ================== */
        :root {
            --ocean: #0D8ABC;
            --ocean2: #7aa9ff;
            --mint: #37c8a6;
            --green: #1a8917;
            --bg1: #f7fbff;
            --bg2: #ffffff;
            --bg3: #fbf8ff;
            --text: #0b1220;
            --muted: #6b7280;
            --panel: rgba(255,255,255,.82);
            --border: rgba(15, 23, 42, .10);
            --shadow: 0 18px 50px rgba(15, 23, 42, .10);
            --shadow-soft: 0 12px 28px rgba(15, 23, 42, .07);
            --radius: 18px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
            margin: 0;
            background: linear-gradient(180deg, var(--bg1) 0%, var(--bg2) 55%, var(--bg3) 100%);
            color: var(--text);
        }

        .container-fluid {
            display: flex;
            min-height: 100vh;
        }

        /* --- 1. SOL MENÜ --- */
        .sidebar-left {
            width: 300px;
            padding: 28px 26px;
            border-right: 1px solid var(--border);
            position: sticky;
            top: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
            flex-shrink: 0;
            background: rgba(255,255,255,.74);
            backdrop-filter: blur(10px);
        }

        .logo-container {
            display: flex;
            align-items: center;
            margin-bottom: 34px;
        }

        .logo {
            font-size: 28px;
            font-weight: 900;
            letter-spacing: -1.2px;
            color: var(--text);
            text-decoration: none;
            position: relative;
            padding-left: 6px;
        }

            .logo::after {
                content: "";
                position: absolute;
                left: 0;
                bottom: -10px;
                width: 78px;
                height: 10px;
                border-radius: 999px;
                background: linear-gradient(90deg, rgba(13,138,188,.25), rgba(167,139,250,.18));
            }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 11px 12px;
            font-size: 15px;
            color: var(--muted);
            text-decoration: none;
            transition: .18s;
            border-radius: 12px;
            margin-bottom: 6px;
        }

            .menu-item:hover {
                color: var(--text);
                background: rgba(13,138,188,.08);
            }

            .menu-item.active {
                color: var(--text) !important;
                font-weight: 800;
                background: linear-gradient(90deg, rgba(13,138,188,.14), rgba(167,139,250,.10));
                box-shadow: 0 12px 22px rgba(13,138,188,.08);
            }

        .menu-icon {
            margin-right: 14px;
            font-size: 20px;
            width: 26px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .menu-group {
            margin-top: 22px;
            padding-top: 18px;
            border-top: 1px solid var(--border);
        }

        .menu-group-title {
            font-size: 12px;
            font-weight: 900;
            color: var(--text);
            text-transform: uppercase;
            margin-bottom: 6px;
            letter-spacing: .6px;
        }

        .write-btn {
            color: var(--green) !important;
            font-weight: 800;
        }

            .write-btn:hover {
                background: rgba(26,137,23,.08);
                color: #156d12 !important;
            }

        /* --- 2. STATS İÇERİK ALANI --- */
        .content-area {
            flex-grow: 1;
            padding: 54px 88px;
            max-width: 1100px; /* daha dolu */
            position: relative;
            box-sizing: border-box;
        }

            /* soft arka plan şekilleri */
            .content-area::before {
                content: "";
                position: absolute;
                inset: -60px -80px auto -80px;
                height: 320px;
                background: radial-gradient(220px 160px at 15% 30%, rgba(13,138,188,.14), transparent 60%), radial-gradient(220px 160px at 70% 20%, rgba(167,139,250,.14), transparent 60%), radial-gradient(220px 160px at 55% 80%, rgba(55,200,166,.12), transparent 60%);
                pointer-events: none;
                filter: blur(2px);
                z-index: 0;
            }

        .stats-header-title {
            position: relative;
            z-index: 1;
            font-size: 48px;
            font-weight: 900;
            margin: 0 0 18px 0;
            letter-spacing: -1.2px;
            color: var(--text);
        }

        /* Sekmeler */
        .stats-tabs {
            position: relative;
            z-index: 1;
            display: inline-flex;
            gap: 10px;
            border: 1px solid var(--border);
            border-radius: 999px;
            padding: 6px;
            background: rgba(255,255,255,.75);
            box-shadow: var(--shadow-soft);
            backdrop-filter: blur(10px);
            margin-bottom: 28px;
        }

        .s-tab {
            padding: 10px 14px;
            font-size: 14px;
            color: var(--muted);
            cursor: pointer;
            position: relative;
            text-decoration: none;
            border-radius: 999px;
            font-weight: 800;
            transition: .18s;
        }

            .s-tab:hover {
                background: rgba(13,138,188,.08);
                color: var(--text);
            }

            .s-tab.active {
                color: var(--text);
                background: linear-gradient(90deg, rgba(13,138,188,.16), rgba(167,139,250,.12));
                box-shadow: 0 10px 18px rgba(15,23,42,.06);
            }

                .s-tab.active::after {
                    display: none;
                }

        /* Monthly Bölümü */
        .section-header {
            position: relative;
            z-index: 1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 26px 0 10px 0;
            gap: 16px;
        }

        .section-title {
            font-size: 24px;
            font-weight: 900;
            margin: 0;
            letter-spacing: -.5px;
        }

        .date-btn {
            background: rgba(255,255,255,.85);
            border: 1px solid rgba(15,23,42,.12);
            padding: 9px 14px;
            border-radius: 999px;
            font-size: 13px;
            cursor: pointer;
            color: var(--text);
            box-shadow: 0 10px 22px rgba(15,23,42,.06);
            transition: .15s;
        }

            .date-btn:hover {
                transform: translateY(-1px);
                border-color: rgba(13,138,188,.22);
                box-shadow: 0 14px 28px rgba(15,23,42,.08);
            }

        .date-info {
            position: relative;
            z-index: 1;
            font-size: 13px;
            color: var(--muted);
            margin-bottom: 24px;
        }

        /* Büyük İstatistik Sayıları */
        .stats-grid {
            position: relative;
            z-index: 1;
            display: flex;
            gap: 18px;
            margin-bottom: 22px;
            flex-wrap: wrap;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            min-width: 220px;
            padding: 18px 18px;
            border-radius: 18px;
            background: rgba(255,255,255,.86);
            border: 1px solid rgba(15,23,42,.08);
            box-shadow: var(--shadow-soft);
            backdrop-filter: blur(10px);
            transition: .18s;
        }

            .stat-item:hover {
                transform: translateY(-2px);
                border-color: rgba(13,138,188,.22);
                box-shadow: var(--shadow);
            }

        .stat-number {
            font-size: 34px;
            font-weight: 900;
            color: var(--text);
            letter-spacing: -.6px;
            line-height: 1.1;
        }

        .stat-label {
            font-size: 13px;
            color: var(--muted);
            margin-top: 6px;
            font-weight: 700;
        }

        /* tıklanabilir stat */
        .stat-link {
            text-decoration: none;
            color: inherit;
            display: inline-block;
        }

            .stat-link:hover .stat-label {
                color: var(--text);
            }

        /* Grafik Alanı */
        .chart-container {
            position: relative;
            z-index: 1;
            height: 220px;
            border-radius: 18px;
            border: 1px solid rgba(15,23,42,.08);
            background: rgba(255,255,255,.80);
            box-shadow: var(--shadow-soft);
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
            padding: 18px 18px 10px 18px;
            margin: 10px 0 10px;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

            .chart-container::before {
                content: "";
                position: absolute;
                inset: 0;
                background: linear-gradient(180deg, rgba(13,138,188,.07), transparent 55%), radial-gradient(220px 160px at 20% 30%, rgba(167,139,250,.10), transparent 60%), radial-gradient(220px 160px at 80% 70%, rgba(55,200,166,.08), transparent 60%);
                pointer-events: none;
            }

        .chart-bar {
            width: 2px;
            height: 100%;
            background-color: rgba(15,23,42,.08);
            border-radius: 999px;
            position: relative;
            z-index: 1;
        }

        .chart-dates {
            position: relative;
            z-index: 1;
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--muted);
            margin-bottom: 32px;
            padding: 0 6px;
        }

        /* Alt Kısım (Lifetime) */
        .table-header {
            position: relative;
            z-index: 1;
            display: flex;
            border-bottom: 1px solid rgba(15,23,42,.10);
            padding-bottom: 14px;
            margin-top: 34px;
            font-size: 13px;
            color: var(--muted);
            font-weight: 800;
            letter-spacing: .2px;
        }

        .col-story {
            flex: 4;
        }

        .col-stat {
            flex: 1;
            text-align: right;
        }

        .empty-state-container {
            position: relative;
            z-index: 1;
            padding: 36px 18px;
            text-align: center;
            border: 1px solid rgba(15,23,42,.08);
            border-radius: 18px;
            background: rgba(255,255,255,.86);
            box-shadow: var(--shadow-soft);
            margin-top: 18px;
            backdrop-filter: blur(10px);
        }

        .empty-text {
            font-size: 16px;
            margin-bottom: 18px;
            color: var(--text);
            font-weight: 700;
        }

        .btn-black {
            background: linear-gradient(135deg, rgba(13,138,188,.16), rgba(167,139,250,.12));
            color: #0b5f83;
            border: 1px solid rgba(13,138,188,.22);
            padding: 10px 18px;
            border-radius: 999px;
            font-size: 14px;
            text-decoration: none;
            cursor: pointer;
            font-weight: 900;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 14px 28px rgba(13,138,188,.10);
            transition: .15s;
        }

            .btn-black:hover {
                transform: translateY(-1px);
                box-shadow: 0 18px 36px rgba(13,138,188,.14);
                border-color: rgba(13,138,188,.30);
            }

        /* followers/following liste kartları */
        .people-wrap {
            position: relative;
            z-index: 1;
            margin-top: 26px;
            padding: 18px 18px;
            border-radius: 18px;
            background: rgba(255,255,255,.72);
            border: 1px solid rgba(15,23,42,.08);
            box-shadow: var(--shadow-soft);
            backdrop-filter: blur(10px);
        }

        .people-title {
            font-size: 18px;
            font-weight: 900;
            margin: 0 0 14px 0;
            letter-spacing: -.2px;
        }

        .person-card {
            border: 1px solid rgba(15,23,42,.08);
            border-radius: 16px;
            padding: 14px 14px;
            margin-bottom: 10px;
            display: flex;
            gap: 12px;
            align-items: flex-start;
            background: rgba(255,255,255,.86);
            box-shadow: 0 10px 22px rgba(15,23,42,.06);
            transition: .18s;
        }

            .person-card:hover {
                transform: translateY(-2px);
                border-color: rgba(13,138,188,.22);
                box-shadow: 0 18px 38px rgba(15,23,42,.10);
            }

        .avatar {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(13,138,188,.95), rgba(167,139,250,.70));
            color: #fff;
            font-weight: 900;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-size: 12px;
            box-shadow: 0 12px 22px rgba(13,138,188,.18);
        }

        .p-name {
            font-weight: 900;
            margin: 0;
            color: var(--text);
        }

        .p-about {
            margin: 6px 0 0;
            color: var(--muted);
            font-size: 13px;
            line-height: 1.6;
            white-space: pre-wrap;
        }

        .muted {
            color: var(--muted);
        }

        /* Responsive */
        @@media (max-width: 1100px) {
            .content-area {
                padding: 44px 44px;
            }

            .sidebar-left {
                width: 280px;
            }
        }

        @@media (max-width: 820px) {
            .sidebar-left {
                display: none;
            }

            .content-area {
                max-width: 100%;
            }

            .stats-header-title {
                font-size: 40px;
            }

            .stats-grid {
                gap: 12px;
            }

            .stat-item {
                min-width: 160px;
                flex: 1;
            }
        }

        @@media (max-width: 520px) {
            .content-area {
                padding: 26px 16px;
            }

            .chart-container {
                height: 200px;
                padding: 14px 12px 10px;
            }
        }
    </style>

</head>
<body>

    <div class="container-fluid">
        <nav class="sidebar-left">
            <div class="logo-container">
                <a asp-controller="Home" asp-action="Index" class="logo">NOVUS</a>
            </div>

            <a asp-controller="Home" asp-action="Index" class="menu-item"><span class="menu-icon">🏠</span> Home</a>
            <a asp-controller="Home" asp-action="Library" class="menu-item"><span class="menu-icon">📚</span> Library</a>
            <a asp-controller="Home" asp-action="Profile" class="menu-item"><span class="menu-icon">👤</span> Profile</a>

            <div class="menu-group">
                <a asp-controller="Home" asp-action="Stats" class="menu-item active"><span class="menu-icon">📊</span> Stats</a>
                <a asp-controller="Home" asp-action="Write" class="menu-item write-btn">
                    <span class="menu-icon">✍️</span> Write
                </a>
            </div>
        </nav>

        <div class="content-area">

            <h1 class="stats-header-title">Stats</h1>

            <div class="stats-tabs">
                <a class="s-tab @(activeTab == "stories" ? "active" : "")"
                   asp-controller="Home" asp-action="Stats" asp-route-tab="stories">Stories</a>

                <a class="s-tab @((activeTab == "followers" || activeTab == "following") ? "active" : "")"
                   asp-controller="Home" asp-action="Stats" asp-route-tab="followers">Audience</a>
            </div>

            <div class="section-header">
                <h2 class="section-title">Monthly</h2>
                <button class="date-btn">December 2025 ⌄</button>
            </div>
            <div class="date-info">December 1, 2025 – Today (UTC) · Updated hourly</div>

            @* ✅ DEĞİŞEN KISIM: sayılar DB’den + followers/following tıklanınca aynı sayfada liste *@
            <div class="stats-grid">
                <div class="stat-item">
                    <span class="stat-number">@((int)(ViewBag.BlogCount ?? 0))</span>
                    <span class="stat-label">Stories</span>
                </div>

                <div class="stat-item">
                    <a class="stat-link" asp-controller="Home" asp-action="Stats" asp-route-tab="followers">
                        <span class="stat-number">@((int)(ViewBag.FollowerCount ?? 0))</span>
                        <span class="stat-label">Followers</span>
                    </a>
                </div>

                <div class="stat-item">
                    <a class="stat-link" asp-controller="Home" asp-action="Stats" asp-route-tab="following">
                        <span class="stat-number">@((int)(ViewBag.FollowingCount ?? 0))</span>
                        <span class="stat-label">Following</span>
                    </a>
                </div>
            </div>

            <div class="chart-container">
                @for (int i = 0; i < 30; i++)
                {
                    <div class="chart-bar"></div>
                }
            </div>
            <div class="chart-dates">
                <span>Dec 1</span>
                <span>Dec 8</span>
                <span>Dec 15</span>
            </div>

            @* ✅ Aynı sayfada liste alanı *@
            @if (activeTab == "followers" || activeTab == "following")
            {
                <div class="people-wrap">
                    <h3 class="people-title">
                        @(activeTab == "followers" ? "Followers" : "Following")
                    </h3>

                    @if (people != null && people.Any())
                    {
                        foreach (var u in people)
                        {
                            string uname = u.username as string ?? "Kullanıcı";
                            string about = u.about as string ?? "";

                            string initials = "NV";
                            if (!string.IsNullOrWhiteSpace(uname))
                            {
                                var parts = uname.Trim().Split(' ', StringSplitOptions.RemoveEmptyEntries);
                                if (parts.Length == 1)
                                    initials = parts[0].Substring(0, Math.Min(2, parts[0].Length)).ToUpper();
                                else
                                    initials = (parts[0][0].ToString() + parts[^1][0].ToString()).ToUpper();
                            }

                            <div class="person-card">
                                <div class="avatar">@initials</div>
                                <div>
                                    <p class="p-name">@uname</p>
                                    @if (!string.IsNullOrWhiteSpace(about))
                                    {
                                        <p class="p-about">@about</p>
                                    }
                                    else
                                    {
                                        <p class="p-about muted">Henüz “Hakkımda” eklenmemiş.</p>
                                    }
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <p class="muted">Bu listede kimse yok.</p>
                    }
                </div>
            }

            <div class="section-header" style="margin-top: 50px;">
                <h2 class="section-title">Lifetime</h2>
                <button class="date-btn">Latest ⌄</button>
            </div>

            <div class="table-header">
                <div class="col-story">Story</div>
                <div class="col-stat">Presentations ⓘ</div>
                <div class="col-stat">Views</div>
                <div class="col-stat">Reads</div>
            </div>

            <div class="empty-state-container">
                <p class="empty-text">You haven't published any stories yet.</p>
                <a href="/Home/Write" class="btn-black">Start writing</a>
            </div>

        </div>
    </div>

</body>
</html>
